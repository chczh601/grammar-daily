# 添加微信登录功能任务清单

## 计划
- [x] 1. 数据库设计
  - [x] 1.1 创建 profiles 用户信息表
  - [x] 1.2 设置 RLS 安全策略
  - [x] 1.3 创建管理员初始化触发器
- [x] 2. 启用 Supabase Auth
  - [x] 2.1 启用手机号和邮箱 OTP 验证
- [x] 3. 修改数据库 API
  - [x] 3.1 移除固定 USER_ID，改为从 auth 获取
  - [x] 3.2 添加用户信息相关 API
- [x] 4. 配置全局认证
  - [x] 4.1 在 app.tsx 中添加 AuthProvider
  - [x] 4.2 更新 app.config.ts 添加登录页路由
- [x] 5. 创建登录页面
  - [x] 5.1 使用 miaoda-auth-taro 的 LoginPanel 组件
- [x] 6. 修改现有页面
  - [x] 6.1 添加 useAuth 保护需要登录的页面
  - [x] 6.2 在个人中心显示用户信息和退出登录按钮
- [x] 7. 测试验证
  - [x] 7.1 运行 lint 检查通过

## 完成情况
✅ 所有任务已完成！

## 实现细节
1. **数据库设计**
   - 创建了 profiles 表，包含 id、phone、email、nickname、avatar_url、role 等字段
   - 设置了 RLS 策略，管理员可以访问所有数据，普通用户只能访问自己的数据
   - 创建了触发器，第一个注册的用户自动成为管理员

2. **认证系统**
   - 启用了 Supabase Auth 的手机号和邮箱 OTP 验证
   - 在 app.tsx 中配置了 AuthProvider
   - 创建了登录页面，使用 miaoda-auth-taro 的 LoginPanel 组件

3. **数据隔离**
   - 所有数据库 API 都使用真实用户 ID
   - 每个用户只能访问自己的数据
   - 管理员可以访问所有数据

4. **用户体验**
   - 未登录用户访问需要登录的页面时，自动跳转到登录页
   - 登录成功后自动跳转到每日练习页面
   - 个人中心显示用户信息和退出登录按钮

## 注意事项
- ✅ 确保不影响现有功能
- ✅ 保持数据库表结构不变
- ✅ 用户数据完全隔离
- ✅ 第一个用户自动成为管理员
