# 英语语法每日一练 - 开发指南

## 1. 项目概述

英语语法每日一练是一款基于微信小程序平台的英语学习应用，帮助用户通过每日练习提升英语语法能力。

### 1.1 项目定位
- 目标用户：英语学习者，尤其是需要提升语法基础的学生和职场人士
- 核心价值：每日定量练习，智能反馈，个性化学习路径
- 产品特色：简洁易用的界面，丰富的语法知识点覆盖，详细的解析说明

### 1.2 技术架构
- **前端框架**：Taro 3.x + React + TypeScript
- **后端服务**：Supabase (PostgreSQL + Authentication + Storage)
- **开发工具**：微信开发者工具
- **状态管理**：React Context API
- **样式方案**：Tailwind CSS

## 2. 环境搭建

### 2.1 前置要求
- Node.js 16.x 或更高版本
- npm 或 yarn 包管理器
- 微信开发者工具
- Taro CLI：`npm install -g @tarojs/cli`

### 2.2 项目初始化

```bash
# 克隆仓库
git clone https://github.com/chczh601/grammar-daily.git
cd grammar-daily

# 安装依赖
npm install

# 启动开发服务器
npm run dev:weapp
```

### 2.3 Supabase 配置

1. 访问 [Supabase 官网](https://supabase.com/) 注册账号
2. 创建新的项目
3. 获取项目的 API 密钥和 URL
4. 在项目根目录创建 `.env` 文件：

```env
REACT_APP_SUPABASE_URL=your-supabase-url
REACT_APP_SUPABASE_ANON_KEY=your-supabase-anon-key
```

## 3. 项目结构

```
├── config/                # 项目配置文件
│   ├── dev.js            # 开发环境配置
│   ├── index.js          # 全局配置
│   └── prod.js           # 生产环境配置
├── src/                   # 源代码目录
│   ├── components/       # 公共组件
│   │   ├── AnswerCard/  # 答题卡片组件
│   │   ├── GrammarCard/ # 语法知识卡片组件
│   │   └── Header/      # 头部组件
│   ├── pages/            # 页面文件
│   │   ├── index/       # 首页
│   │   ├── daily-practice/ # 每日练习页
│   │   ├── study-record/  # 学习记录页
│   │   ├── grammar-knowledge/ # 语法知识页
│   │   └── mine/        # 个人中心页
│   ├── services/         # 服务层
│   │   ├── api.ts       # API 接口
│   │   └── supabase.ts  # Supabase 客户端配置
│   ├── types/            # TypeScript 类型定义
│   ├── utils/            # 工具函数
│   ├── app.config.ts     # 小程序全局配置
│   ├── app.tsx           # 小程序入口组件
│   └── index.html        # HTML 模板
├── .env.example          # 环境变量示例
├── .gitignore            # Git 忽略文件
├── package.json          # 项目依赖
├── tsconfig.json         # TypeScript 配置
└── README.md             # 项目说明
```

## 4. 核心功能开发

### 4.1 每日练习模块

#### 4.1.1 页面结构
```typescript
// src/pages/daily-practice/index.tsx
import React, { useState, useEffect } from 'react'
import { View, Text } from '@tarojs/components'
import { useRouter } from '@tarojs/taro'
import AnswerCard from '@components/AnswerCard'
import { fetchDailyQuestion } from '@services/api'
import type { Question } from '@types/index'

export default function DailyPractice() {
  const router = useRouter()
  const [question, setQuestion] = useState<Question | null>(null)
  const [loading, setLoading] = useState(true)
  const [selectedAnswer, setSelectedAnswer] = useState<string>('')
  const [showResult, setShowResult] = useState(false)

  useEffect(() => {
    loadQuestion()
  }, [])

  const loadQuestion = async () => {
    setLoading(true)
    try {
      const data = await fetchDailyQuestion()
      setQuestion(data)
    } catch (error) {
      console.error('加载题目失败:', error)
    } finally {
      setLoading(false)
    }
  }

  const handleAnswerSelect = (answer: string) => {
    setSelectedAnswer(answer)
  }

  const handleSubmit = () => {
    setShowResult(true)
  }

  return (
    <View className="daily-practice">
      <View className="practice-header">
        <Text className="title">每日练习</Text>
      </View>
      
      {loading ? (
        <View className="loading">加载中...</View>
      ) : question ? (
        <AnswerCard
          question={question}
          selectedAnswer={selectedAnswer}
          showResult={showResult}
          onAnswerSelect={handleAnswerSelect}
          onSubmit={handleSubmit}
        />
      ) : (
        <View className="error">加载失败，请重试</View>
      )}
    </View>
  )
}
```

#### 4.1.2 API 接口
```typescript
// src/services/api.ts
import { supabase } from './supabase'
import type { Question } from '@types/index'

export const fetchDailyQuestion = async (): Promise<Question> => {
  const { data, error } = await supabase
    .from('questions')
    .select('*')
    .eq('is_daily', true)
    .single()

  if (error) {
    throw new Error('获取每日题目失败')
  }

  return data
}
```

### 4.2 学习记录模块

#### 4.2.1 页面结构
```typescript
// src/pages/study-record/index.tsx
import React, { useState, useEffect } from 'react'
import { View, Text, ScrollView } from '@tarojs/components'
import { fetchStudyRecords } from '@services/api'
import type { StudyRecord } from '@types/index'

export default function StudyRecord() {
  const [records, setRecords] = useState<StudyRecord[]>([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    loadRecords()
  }, [])

  const loadRecords = async () => {
    setLoading(true)
    try {
      const data = await fetchStudyRecords()
      setRecords(data)
    } catch (error) {
      console.error('加载学习记录失败:', error)
    } finally {
      setLoading(false)
    }
  }

  return (
    <View className="study-record">
      <View className="record-header">
        <Text className="title">学习记录</Text>
      </View>
      
      <ScrollView className="record-list">
        {loading ? (
          <View className="loading">加载中...</View>
        ) : records.length > 0 ? (
          records.map((record, index) => (
            <View key={index} className="record-item">
              <Text className="record-date">{record.date}</Text>
              <Text className="record-score">得分: {record.score}/{record.total}</Text>
              <Text className="record-accuracy">准确率: {(record.accuracy * 100).toFixed(0)}%</Text>
            </View>
          ))
        ) : (
          <View className="empty">暂无学习记录</View>
        )}
      </ScrollView>
    </View>
  )
}
```

### 4.3 语法知识模块

#### 4.3.1 页面结构
```typescript
// src/pages/grammar-knowledge/index.tsx
import React, { useState, useEffect } from 'react'
import { View, Text, ScrollView } from '@tarojs/components'
import { fetchGrammarTopics } from '@services/api'
import GrammarCard from '@components/GrammarCard'
import type { GrammarTopic } from '@types/index'

export default function GrammarKnowledge() {
  const [topics, setTopics] = useState<GrammarTopic[]>([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    loadTopics()
  }, [])

  const loadTopics = async () => {
    setLoading(true)
    try {
      const data = await fetchGrammarTopics()
      setTopics(data)
    } catch (error) {
      console.error('加载语法知识点失败:', error)
    } finally {
      setLoading(false)
    }
  }

  return (
    <View className="grammar-knowledge">
      <View className="knowledge-header">
        <Text className="title">语法知识</Text>
      </View>
      
      <ScrollView className="topic-list">
        {loading ? (
          <View className="loading">加载中...</View>
        ) : topics.length > 0 ? (
          topics.map((topic, index) => (
            <GrammarCard key={index} topic={topic} />
          ))
        ) : (
          <View className="empty">暂无语法知识点</View>
        )}
      </ScrollView>
    </View>
  )
}
```

## 5. 数据模型设计

### 5.1 数据库表结构

#### 5.1.1 questions 表
| 字段名 | 数据类型 | 描述 |
|-------|---------|------|
| id | uuid | 题目ID |
| content | text | 题目内容 |
| type | varchar(20) | 题目类型 (single/blank/correct) |
| options | jsonb | 选项内容 |
| correct_answer | text | 正确答案 |
| explanation | text | 解析说明 |
| grammar_point | varchar(50) | 语法知识点 |
| difficulty | int | 难度等级 (1-5) |
| is_daily | boolean | 是否为每日一题 |
| created_at | timestamp | 创建时间 |

#### 5.1.2 study_records 表
| 字段名 | 数据类型 | 描述 |
|-------|---------|------|
| id | uuid | 记录ID |
| user_id | uuid | 用户ID |
| date | date | 学习日期 |
| score | int | 得分 |
| total | int | 总题数 |
| accuracy | float | 准确率 |
| created_at | timestamp | 创建时间 |

#### 5.1.3 grammar_topics 表
| 字段名 | 数据类型 | 描述 |
|-------|---------|------|
| id | uuid | 知识点ID |
| title | varchar(100) | 知识点标题 |
| description | text | 知识点描述 |
| examples | jsonb | 示例 |
| created_at | timestamp | 创建时间 |

## 6. 测试与调试

### 6.1 本地测试

```bash
# 启动开发服务器
npm run dev:weapp

# 运行类型检查
npm run typecheck

# 运行 lint 检查
npm run lint
```

### 6.2 真机调试
1. 在微信开发者工具中点击「真机调试」
2. 使用微信扫描二维码
3. 在手机上进行功能测试

### 6.3 测试用例

参考 `TESTING_GUIDE.md` 文件中的测试用例进行功能测试。

## 7. 部署与发布

### 7.1 构建生产版本

```bash
npm run build:weapp
```

### 7.2 发布流程
1. 在微信开发者工具中导入构建后的 `dist` 目录
2. 进行代码审核
3. 提交审核申请
4. 审核通过后发布上线

## 8. 常见问题与解决方案

### 8.1 开发环境问题
- **问题**：Taro CLI 安装失败
  **解决方案**：确保 Node.js 版本符合要求，尝试使用管理员权限安装

- **问题**：微信开发者工具无法识别项目
  **解决方案**：检查项目根目录是否有 `project.config.json` 文件，确保配置正确

### 8.2 功能实现问题
- **问题**：答题结果无法正确保存
  **解决方案**：检查 Supabase 权限设置，确保用户有写入 `study_records` 表的权限

- **问题**：页面跳转失败
  **解决方案**：检查路由配置，确保使用了 Taro 提供的路由 API

## 9. 开发规范

### 9.1 代码规范
- 使用 TypeScript 进行类型定义
- 遵循 React Hooks 最佳实践
- 组件命名使用 PascalCase
- 函数命名使用 camelCase
- 变量命名使用 camelCase

### 9.2 提交规范
- 提交信息使用中文描述
- 提交信息格式：`类型: 描述`
  - 类型：feat(新功能)、fix(修复)、docs(文档)、style(样式)、refactor(重构)、test(测试)
  - 示例：`feat: 增加学习记录功能`

### 9.3 分支管理
- `master`：主分支，用于发布生产版本
- `develop`：开发分支，用于集成新功能
- `feature/*`：功能分支，用于开发特定功能
- `bugfix/*`：修复分支，用于修复生产环境 bug

## 10. 后续开发计划

### 10.1 近期规划
- [ ] 增加用户登录功能
- [ ] 实现个性化推荐功能
- [ ] 优化答题界面交互

### 10.2 远期规划
- [ ] 增加听力练习模块
- [ ] 支持多语言切换
- [ ] 开发 web 版本

## 11. 联系方式

如有任何问题或建议，请联系项目维护者：
- GitHub：https://github.com/chczh601/grammar-daily
- 邮箱：your-email@example.com

---

**最后更新时间**：2026-01-08
**版本**：v1.0.0